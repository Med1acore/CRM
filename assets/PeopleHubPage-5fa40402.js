import{c as T,j as i,r as f,b as B,d as H,e as q,g as Z,X as N,z as K}from"./index-a21bb311.js";import{P as G,A as Q}from"./AddUserModal-1755d7e9.js";import{P as Y}from"./plus-4344ddf8.js";import{S as O}from"./search-8654424b.js";import{U as J}from"./user-f0d27580.js";import{M as X}from"./mail-9763a4f0.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=T("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=T("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=T("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=T("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);function ne({person:t,onEdit:r,onDelete:e}){return i.jsxs("div",{className:"bg-card border border-border rounded-lg p-4 flex gap-4",children:[i.jsx("div",{className:"flex-shrink-0",children:i.jsx("div",{className:"h-16 w-16 rounded-full bg-primary/20 flex items-center justify-center",children:i.jsx(J,{className:"h-8 w-8 text-primary"})})}),i.jsxs("div",{className:"flex-grow flex flex-col gap-3",children:[i.jsxs("div",{className:"flex-grow",children:[i.jsx("h3",{className:"font-bold text-lg",children:t.fullName}),i.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2 mt-1",children:[i.jsx(X,{className:"h-4 w-4"})," ",t.email]}),i.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[i.jsx(G,{className:"h-4 w-4"})," ",t.phone]})]}),i.jsxs("div",{className:"flex flex-col items-start gap-2",children:[i.jsx("div",{className:"inline-flex px-2 py-1 rounded-md text-xs bg-primary/20 text-primary-foreground/90",children:t.status}),i.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map(s=>i.jsx("span",{className:"px-2 py-0.5 rounded-md text-xs bg-muted text-muted-foreground",children:s},s))})]}),i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsx("button",{className:"btn btn-secondary",onClick:()=>r?r(t.id):console.log("Edit person:",t.id),children:"Редактировать"}),i.jsx("button",{className:"btn btn-danger",onClick:()=>e?e(t.id):console.log("Delete person:",t.id),children:"Удалить"})]})]})]})}function M(t,r,e){let s=e.initialDeps??[],n;function l(){var a,o,d,h;let m;e.key&&((a=e.debug)!=null&&a.call(e))&&(m=Date.now());const v=t();if(!(v.length!==s.length||v.some((u,w)=>s[w]!==u)))return n;s=v;let E;if(e.key&&((o=e.debug)!=null&&o.call(e))&&(E=Date.now()),n=r(...v),e.key&&((d=e.debug)!=null&&d.call(e))){const u=Math.round((Date.now()-m)*100)/100,w=Math.round((Date.now()-E)*100)/100,j=w/16,x=(y,C)=>{for(y=String(y);y.length<C;)y=" "+y;return y};console.info(`%c⏱ ${x(w,5)} /${x(u,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*j,120))}deg 100% 31%);`,e==null?void 0:e.key)}return(h=e==null?void 0:e.onChange)==null||h.call(e,n),n}return l.updateDeps=a=>{s=a},l}function R(t,r){if(t===void 0)throw new Error(`Unexpected undefined${r?`: ${r}`:""}`);return t}const re=(t,r)=>Math.abs(t-r)<1.01,ie=(t,r,e)=>{let s;return function(...n){t.clearTimeout(s),s=t.setTimeout(()=>r.apply(this,n),e)}},I=t=>{const{offsetWidth:r,offsetHeight:e}=t;return{width:r,height:e}},le=t=>t,ae=t=>{const r=Math.max(t.startIndex-t.overscan,0),e=Math.min(t.endIndex+t.overscan,t.count-1),s=[];for(let n=r;n<=e;n++)s.push(n);return s},oe=(t,r)=>{const e=t.scrollElement;if(!e)return;const s=t.targetWindow;if(!s)return;const n=a=>{const{width:o,height:d}=a;r({width:Math.round(o),height:Math.round(d)})};if(n(I(e)),!s.ResizeObserver)return()=>{};const l=new s.ResizeObserver(a=>{const o=()=>{const d=a[0];if(d!=null&&d.borderBoxSize){const h=d.borderBoxSize[0];if(h){n({width:h.inlineSize,height:h.blockSize});return}}n(I(e))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()});return l.observe(e,{box:"border-box"}),()=>{l.unobserve(e)}},A={passive:!0},F=typeof window>"u"?!0:"onscrollend"in window,ce=(t,r)=>{const e=t.scrollElement;if(!e)return;const s=t.targetWindow;if(!s)return;let n=0;const l=t.options.useScrollendEvent&&F?()=>{}:ie(s,()=>{r(n,!1)},t.options.isScrollingResetDelay),a=m=>()=>{const{horizontal:v,isRtl:S}=t.options;n=v?e.scrollLeft*(S&&-1||1):e.scrollTop,l(),r(n,m)},o=a(!0),d=a(!1);d(),e.addEventListener("scroll",o,A);const h=t.options.useScrollendEvent&&F;return h&&e.addEventListener("scrollend",d,A),()=>{e.removeEventListener("scroll",o),h&&e.removeEventListener("scrollend",d)}},de=(t,r,e)=>{if(r!=null&&r.borderBoxSize){const s=r.borderBoxSize[0];if(s)return Math.round(s[e.options.horizontal?"inlineSize":"blockSize"])}return t[e.options.horizontal?"offsetWidth":"offsetHeight"]},ue=(t,{adjustments:r=0,behavior:e},s)=>{var n,l;const a=t+r;(l=(n=s.scrollElement)==null?void 0:n.scrollTo)==null||l.call(n,{[s.options.horizontal?"left":"top"]:a,behavior:e})};class he{constructor(r){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const s=()=>e||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:e=new this.targetWindow.ResizeObserver(n=>{n.forEach(l=>{const a=()=>{this._measureElement(l.target,l)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()})}));return{disconnect:()=>{var n;(n=s())==null||n.disconnect(),e=null},observe:n=>{var l;return(l=s())==null?void 0:l.observe(n,{box:"border-box"})},unobserve:n=>{var l;return(l=s())==null?void 0:l.unobserve(n)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([s,n])=>{typeof n>"u"&&delete e[s]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:le,rangeExtractor:ae,onChange:()=>{},measureElement:de,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var s,n;(n=(s=this.options).onChange)==null||n.call(s,this,e)},this.maybeNotify=M(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const s=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==s){if(this.cleanup(),!s){this.maybeNotify();return}this.scrollElement=s,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((e=this.scrollElement)==null?void 0:e.window)??null,this.elementsCache.forEach(n=>{this.observer.observe(n)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,n=>{this.scrollRect=n,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(n,l)=>{this.scrollAdjustments=0,this.scrollDirection=l?this.getScrollOffset()<n?"forward":"backward":null,this.scrollOffset=n,this.isScrolling=l,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,s)=>{const n=new Map,l=new Map;for(let a=s-1;a>=0;a--){const o=e[a];if(n.has(o.lane))continue;const d=l.get(o.lane);if(d==null||o.end>d.end?l.set(o.lane,o):o.end<d.end&&n.set(o.lane,!0),n.size===this.options.lanes)break}return l.size===this.options.lanes?Array.from(l.values()).sort((a,o)=>a.end===o.end?a.index-o.index:a.end-o.end)[0]:void 0},this.getMeasurementOptions=M(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(e,s,n,l,a)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:s,scrollMargin:n,getItemKey:l,enabled:a}),{key:!1}),this.getMeasurements=M(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:s,scrollMargin:n,getItemKey:l,enabled:a},o)=>{if(!a)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(m=>{this.itemSizeCache.set(m.key,m.size)}));const d=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const h=this.measurementsCache.slice(0,d);for(let m=d;m<e;m++){const v=l(m),S=this.options.lanes===1?h[m-1]:this.getFurthestMeasurement(h,m),E=S?S.end+this.options.gap:s+n,u=o.get(v),w=typeof u=="number"?u:this.options.estimateSize(m),j=E+w,x=S?S.lane:m%this.options.lanes;h[m]={index:m,start:E,size:w,end:j,key:v,lane:x}}return this.measurementsCache=h,h},{key:!1,debug:()=>this.options.debug}),this.calculateRange=M(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,s,n,l)=>this.range=e.length>0&&s>0?me({measurements:e,outerSize:s,scrollOffset:n,lanes:l}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=M(()=>{let e=null,s=null;const n=this.calculateRange();return n&&(e=n.startIndex,s=n.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,s]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,s]},(e,s,n,l,a)=>l===null||a===null?[]:e({startIndex:l,endIndex:a,overscan:s,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const s=this.options.indexAttribute,n=e.getAttribute(s);return n?parseInt(n,10):(console.warn(`Missing attribute name '${s}={index}' on measured element.`),-1)},this._measureElement=(e,s)=>{const n=this.indexFromElement(e),l=this.measurementsCache[n];if(!l)return;const a=l.key,o=this.elementsCache.get(a);o!==e&&(o&&this.observer.unobserve(o),this.observer.observe(e),this.elementsCache.set(a,e)),e.isConnected&&this.resizeItem(n,this.options.measureElement(e,s,this))},this.resizeItem=(e,s)=>{const n=this.measurementsCache[e];if(!n)return;const l=this.itemSizeCache.get(n.key)??n.size,a=s-l;a!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(n,a,this):n.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=a,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,s)),this.notify(!1))},this.measureElement=e=>{if(!e){this.elementsCache.forEach((s,n)=>{s.isConnected||(this.observer.unobserve(s),this.elementsCache.delete(n))});return}this._measureElement(e,void 0)},this.getVirtualItems=M(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,s)=>{const n=[];for(let l=0,a=e.length;l<a;l++){const o=e[l],d=s[o];n.push(d)}return n},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const s=this.getMeasurements();if(s.length!==0)return R(s[$(0,s.length-1,n=>R(s[n]).start,e)])},this.getOffsetForAlignment=(e,s,n=0)=>{const l=this.getSize(),a=this.getScrollOffset();s==="auto"&&(s=e>=a+l?"end":"start"),s==="center"?e+=(n-l)/2:s==="end"&&(e-=l);const o=this.getTotalSize()+this.options.scrollMargin-l;return Math.max(Math.min(o,e),0)},this.getOffsetForIndex=(e,s="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const n=this.measurementsCache[e];if(!n)return;const l=this.getSize(),a=this.getScrollOffset();if(s==="auto")if(n.end>=a+l-this.options.scrollPaddingEnd)s="end";else if(n.start<=a+this.options.scrollPaddingStart)s="start";else return[a,s];const o=s==="end"?n.end+this.options.scrollPaddingEnd:n.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(o,s,n.size),s]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:s="start",behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,s),{adjustments:void 0,behavior:n})},this.scrollToIndex=(e,{align:s="auto",behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let l=0;const a=10,o=h=>{if(!this.targetWindow)return;const m=this.getOffsetForIndex(e,h);if(!m){console.warn("Failed to get offset for index:",e);return}const[v,S]=m;this._scrollToOffset(v,{adjustments:void 0,behavior:n}),this.targetWindow.requestAnimationFrame(()=>{const E=this.getScrollOffset(),u=this.getOffsetForIndex(e,S);if(!u){console.warn("Failed to get offset for index:",e);return}re(u[0],E)||d(S)})},d=h=>{this.targetWindow&&(l++,l<a?this.targetWindow.requestAnimationFrame(()=>o(h)):console.warn(`Failed to scroll to index ${e} after ${a} attempts.`))};o(s)},this.scrollBy=(e,{behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:s})},this.getTotalSize=()=>{var e;const s=this.getMeasurements();let n;if(s.length===0)n=this.options.paddingStart;else if(this.options.lanes===1)n=((e=s[s.length-1])==null?void 0:e.end)??0;else{const l=Array(this.options.lanes).fill(null);let a=s.length-1;for(;a>=0&&l.some(o=>o===null);){const o=s[a];l[o.lane]===null&&(l[o.lane]=o.end),a--}n=Math.max(...l.filter(o=>o!==null))}return Math.max(n-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:s,behavior:n})=>{this.options.scrollToFn(e,{behavior:n,adjustments:s},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(r)}}const $=(t,r,e,s)=>{for(;t<=r;){const n=(t+r)/2|0,l=e(n);if(l<s)t=n+1;else if(l>s)r=n-1;else return n}return t>0?t-1:0};function me({measurements:t,outerSize:r,scrollOffset:e,lanes:s}){const n=t.length-1,l=d=>t[d].start;if(t.length<=s)return{startIndex:0,endIndex:n};let a=$(0,n,l,e),o=a;if(s===1)for(;o<n&&t[o].end<e+r;)o++;else if(s>1){const d=Array(s).fill(0);for(;o<n&&d.some(m=>m<e+r);){const m=t[o];d[m.lane]=m.end,o++}const h=Array(s).fill(e+r);for(;a>=0&&h.some(m=>m>=e);){const m=t[a];h[m.lane]=m.start,a--}a=Math.max(0,a-a%s),o=Math.min(n,o+(s-1-o%s))}return{startIndex:a,endIndex:o}}const U=typeof document<"u"?f.useLayoutEffect:f.useEffect;function fe(t){const r=f.useReducer(()=>({}),{})[1],e={...t,onChange:(n,l)=>{var a;l?B.flushSync(r):r(),(a=t.onChange)==null||a.call(t,n,l)}},[s]=f.useState(()=>new he(e));return s.setOptions(e),U(()=>s._didMount(),[]),U(()=>s._willUpdate()),s}function W(t){return fe({observeElementRect:oe,observeElementOffset:ce,scrollToFn:ue,...t})}function pe({people:t,onEdit:r,onDelete:e}){const s=f.useRef(null),n=W({count:Math.ceil(t.length/3),getScrollElement:()=>s.current,estimateSize:()=>220,overscan:5});return i.jsx("div",{ref:s,className:"h-[70vh] overflow-y-auto",children:i.jsx("div",{className:"relative w-full",style:{height:`${n.getTotalSize()}px`},children:n.getVirtualItems().map(l=>{const a=l.index*3,o=Math.min(a+3,t.length),d=t.slice(a,o);return i.jsx("div",{className:"absolute top-0 left-0 w-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",style:{height:`${l.size}px`,transform:`translateY(${l.start}px)`,padding:"0 8px"},children:d.map(h=>i.jsx(ne,{person:h,onEdit:r,onDelete:e},h.id))},l.key)})})})}/**
   * react-table
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function L(t,r){return t?ge(t)?f.createElement(t,r):t:null}function ge(t){return xe(t)||typeof t=="function"||ye(t)}function xe(t){return typeof t=="function"&&(()=>{const r=Object.getPrototypeOf(t);return r.prototype&&r.prototype.isReactComponent})()}function ye(t){return typeof t=="object"&&typeof t.$$typeof=="symbol"&&["react.memo","react.forward_ref"].includes(t.$$typeof.description)}function be(t){const r={state:{},onStateChange:()=>{},renderFallbackValue:null,...t},[e]=f.useState(()=>({current:H(r)})),[s,n]=f.useState(()=>e.current.initialState);return e.current.setOptions(l=>({...l,...t,state:{...s,...t.state},onStateChange:a=>{n(a),t.onStateChange==null||t.onStateChange(a)}})),e.current}function ve({people:t}){const r=be({data:t,columns:q,getCoreRowModel:Z()}),{rows:e}=r.getRowModel(),s=f.useRef(null),n=W({count:e.length,getScrollElement:()=>s.current,estimateSize:()=>50,overscan:10});return i.jsx("div",{ref:s,className:"h-[70vh] overflow-auto border rounded-lg",children:i.jsxs("table",{className:"min-w-full",children:[i.jsx("thead",{className:"sticky top-0 bg-card",children:r.getHeaderGroups().map(l=>i.jsx("tr",{children:l.headers.map(a=>i.jsx("th",{className:"p-4 text-left font-medium text-muted-foreground",children:L(a.column.columnDef.header,a.getContext())},a.id))},l.id))}),i.jsx("tbody",{style:{height:`${n.getTotalSize()}px`,position:"relative"},children:n.getVirtualItems().map(l=>{const a=e[l.index];return i.jsx("tr",{style:{position:"absolute",top:0,left:0,width:"100%",height:`${l.size}px`,transform:`translateY(${l.start}px)`},className:"border-b",children:a.getVisibleCells().map(o=>i.jsx("td",{className:"p-4",children:L(o.column.columnDef.cell,o.getContext())},o.id))},a.id)})})]})})}function Se({viewMode:t,setViewMode:r}){return i.jsxs("div",{className:"flex gap-1 p-1 bg-muted rounded-md",children:[i.jsx("button",{className:`btn ${t==="grid"?"btn-secondary":"btn"}`,onClick:()=>r("grid"),children:i.jsx(ee,{className:"h-4 w-4"})}),i.jsx("button",{className:`btn ${t==="list"?"btn-secondary":"btn"}`,onClick:()=>r("list"),children:i.jsx(se,{className:"h-4 w-4"})})]})}function we({onSearch:t,people:r}){var C,_;const[e,s]=f.useState(""),[n,l]=f.useState(!1),[a,o]=f.useState([]),[d,h]=f.useState({}),m=f.useRef(null),v=[...new Set(r.map(c=>c.status))],S=[...new Set(r.flatMap(c=>c.tags))],E=["Покажи всех гостей","Найди участников с тегом Музыка","Покажи всех лидеров в Молодежном служении","Найди активных участников с тегами Музыка и Проповедь"];f.useEffect(()=>{if(!e.trim()){o([...E.map(g=>({text:g,type:"example",description:"Пример запроса"})),...v.map(g=>({text:`Покажи всех ${g}`,type:"status",description:"Фильтр по статусу"})),...S.slice(0,5).map(g=>({text:`Найди с тегом ${g}`,type:"tag",description:"Фильтр по тегу"}))]);return}const c=[],p=e.toLowerCase();v.forEach(g=>{g.toLowerCase().includes(p)&&c.push({text:`Покажи всех ${g}`,type:"status",description:"Фильтр по статусу"})}),S.forEach(g=>{g.toLowerCase().includes(p)&&c.push({text:`Найди с тегом ${g}`,type:"tag",description:"Фильтр по тегу"})}),E.forEach(g=>{g.toLowerCase().includes(p)&&c.push({text:g,type:"example",description:"Пример запроса"})}),o(c.slice(0,8))},[e,v,S]);const u=c=>{const p={},g=c.toLowerCase();if(v.forEach(b=>{(g.includes(b.toLowerCase())||g.includes("гост")&&b==="guest"||g.includes("актив")&&b==="active"||g.includes("нов")&&b==="new"||g.includes("лидер")&&b==="leader")&&(p.status=[...p.status||[],b])}),S.forEach(b=>{(g.includes(b.toLowerCase())||g.includes("тег")&&g.includes(b.toLowerCase()))&&(p.tags=[...p.tags||[],b])}),!p.status&&!p.tags){const b=c.split(" ").filter(k=>k.length>2);b.length>0&&(p.name=b.join(" "))}return p},w=(c=e)=>{const p=u(c);h(p),t(c,p),l(!1)},j=c=>{s(c.text),w(c.text)},x=()=>{h({}),s(""),t("",{})},y=Object.keys(d).length>0;return i.jsxs("div",{className:"relative",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsxs("div",{className:"relative",children:[i.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),i.jsx("input",{ref:m,type:"text",value:e,onChange:c=>s(c.target.value),onFocus:()=>l(!0),onBlur:()=>setTimeout(()=>l(!1),200),onKeyDown:c=>{c.key==="Enter"&&w(),c.key==="Escape"&&l(!1)},className:"input pl-10 pr-10",placeholder:"Покажи всех гостей с тегом Музыка..."}),e&&i.jsx("button",{onClick:()=>{s(""),w("")},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:i.jsx(N,{className:"h-4 w-4"})})]}),n&&a.length>0&&i.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-[9999] max-h-80 overflow-y-auto",children:a.map((c,p)=>i.jsx("button",{onClick:()=>j(c),className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-600 last:border-b-0",children:i.jsxs("div",{className:"flex items-center gap-3",children:[c.type==="example"&&i.jsx(te,{className:"h-4 w-4 text-yellow-500"}),c.type==="status"&&i.jsx(z,{className:"h-4 w-4 text-blue-500"}),c.type==="tag"&&i.jsx(z,{className:"h-4 w-4 text-green-500"}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:c.text}),c.description&&i.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:c.description})]})]})},p))})]}),i.jsx("button",{onClick:()=>w(),className:"btn btn-primary px-4",children:i.jsx(O,{className:"h-4 w-4"})}),y&&i.jsx("button",{onClick:x,className:"btn btn-secondary px-4",title:"Очистить фильтры",children:i.jsx(N,{className:"h-4 w-4"})})]}),y&&i.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[(C=d.status)==null?void 0:C.map(c=>i.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-md text-sm",children:["Статус: ",c,i.jsx("button",{onClick:()=>{var g,b;const p={...d};p.status=(g=p.status)==null?void 0:g.filter(k=>k!==c),((b=p.status)==null?void 0:b.length)===0&&delete p.status,h(p),t(e,p)},className:"hover:text-blue-600",children:i.jsx(N,{className:"h-3 w-3"})})]},c)),(_=d.tags)==null?void 0:_.map(c=>i.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-md text-sm",children:["Тег: ",c,i.jsx("button",{onClick:()=>{var g,b;const p={...d};p.tags=(g=p.tags)==null?void 0:g.filter(k=>k!==c),((b=p.tags)==null?void 0:b.length)===0&&delete p.tags,h(p),t(e,p)},className:"hover:text-green-600",children:i.jsx(N,{className:"h-3 w-3"})})]},c)),d.name&&i.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md text-sm",children:["Поиск: ",d.name,i.jsx("button",{onClick:()=>{const c={...d};delete c.name,h(c),t(e,c)},className:"hover:text-gray-600",children:i.jsx(N,{className:"h-3 w-3"})})]})]})]})}const Ee={guest:"guest",new_member:"new",active_member:"active",minister:"leader",left:"guest"};function je(t){return Ee[t]??"guest"}const Ce=({total:t})=>i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Люди и участники"}),i.jsxs("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:["Управление данными о членах церкви и гостях",i.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["(Всего: ",t," пользователей)"]})]})]}),Me=({viewMode:t,onViewModeChange:r,onReset:e,onAdd:s})=>i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Se,{viewMode:t,setViewMode:r}),i.jsx("button",{onClick:e,className:"btn btn-secondary",title:"Сбросить данные (для отладки)",children:"Сброс"}),i.jsxs("button",{onClick:s,className:"btn btn-primary",children:[i.jsx(Y,{className:"mr-2 h-4 w-4"}),"Добавить участника"]})]}),ke=({people:t,onSearch:r})=>i.jsxs("div",{className:"card p-6 relative z-10",children:[i.jsxs("div",{className:"mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Умный поиск"}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:'Попробуйте: "Покажи всех гостей с тегом Музыка" или "Найди активных участников"'})]}),i.jsx(we,{onSearch:r,people:t})]}),Ne=({people:t,viewMode:r,onEdit:e,onDelete:s})=>i.jsx("div",{className:"relative z-0",children:r==="grid"?i.jsx(pe,{people:t,onEdit:e,onDelete:s}):i.jsx(ve,{people:t})}),V="crm-users";function _e(t,r){switch(r.type){case"SET_USERS":return{...t,users:r.payload};case"ADD_USER":return{...t,users:[r.payload,...t.users]};case"UPDATE_USER":return{...t,users:t.users.map(e=>e.id===r.payload.id?r.payload:e)};case"DELETE_USER":return{...t,users:t.users.filter(e=>e.id!==r.payload)};case"RESET_USERS":return{...t,users:r.payload};case"SET_VIEW_MODE":return{...t,viewMode:r.payload};case"SET_SMART_FILTERS":return{...t,smartFilters:r.payload};case"SET_SEARCH_TERM":return{...t,searchTerm:r.payload};case"SET_SELECTED_STATUS":return{...t,selectedStatus:r.payload};case"SET_MODAL_OPEN":return{...t,isAddModalOpen:r.payload};case"SET_EDIT_USER":return{...t,editUser:r.payload};default:return t}}const Te={users:[],viewMode:"grid",smartFilters:{},searchTerm:"",selectedStatus:"all",isAddModalOpen:!1,editUser:null};function Oe(t){try{const r=localStorage.getItem(V);if(r)return JSON.parse(r)}catch(r){console.error("Ошибка загрузки пользователей из localStorage:",r)}return t}function ze(t){const[r,e]=f.useReducer(_e,Te,u=>({...u,users:Oe(t)})),s=f.useCallback(u=>{e({type:"ADD_USER",payload:u})},[]),n=f.useCallback(u=>{e({type:"UPDATE_USER",payload:u})},[]),l=f.useCallback(u=>{e({type:"DELETE_USER",payload:u})},[]),a=f.useCallback(u=>{e({type:"RESET_USERS",payload:u})},[]),o=f.useCallback(u=>{e({type:"SET_VIEW_MODE",payload:u})},[]),d=f.useCallback(u=>{e({type:"SET_SMART_FILTERS",payload:u})},[]),h=f.useCallback(u=>{e({type:"SET_SEARCH_TERM",payload:u})},[]),m=f.useCallback(u=>{e({type:"SET_SELECTED_STATUS",payload:u})},[]),v=f.useCallback(u=>{e({type:"SET_MODAL_OPEN",payload:u})},[]),S=f.useCallback(u=>{e({type:"SET_EDIT_USER",payload:u})},[]);f.useEffect(()=>{try{localStorage.setItem(V,JSON.stringify(r.users))}catch(u){console.error("Ошибка сохранения пользователей в localStorage:",u)}},[r.users]);const E=f.useMemo(()=>{const{users:u,searchTerm:w,selectedStatus:j,smartFilters:x}=r;return u.filter(y=>{const C=y.full_name.toLowerCase().includes(w.toLowerCase())||y.email.toLowerCase().includes(w.toLowerCase()),_=j==="all"||y.status===j;let c=!0;if(x.status&&x.status.length>0){const b={active_member:"active",new_member:"new",minister:"leader",guest:"guest",left:"guest"}[y.status]||"guest";c=c&&x.status.includes(b)}return x.tags&&x.tags.length>0&&(c=c&&x.tags.some(g=>y.tags.includes(g))),x.name&&(c=c&&y.full_name.toLowerCase().includes(x.name.toLowerCase())),x.email&&(c=c&&y.email.toLowerCase().includes(x.email.toLowerCase())),Object.keys(x).length>0?c:C&&_})},[r]);return{state:r,filteredUsers:E,addUser:s,updateUser:n,deleteUser:l,setViewMode:o,setSmartFilters:d,setSearchTerm:h,setSelectedStatus:m,setIsAddModalOpen:v,setEditUser:S,resetUsers:a}}const D=[{id:"1",full_name:"Иван Петров",email:"ivan@example.com",phone:"+7 (999) 123-45-67",status:"active_member",tags:["Молодежное служение","Музыка"],avatar_url:null,created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T10:00:00Z"},{id:"2",full_name:"Мария Сидорова",email:"maria@example.com",phone:"+7 (999) 234-56-78",status:"new_member",tags:["Детское служение"],avatar_url:null,created_at:"2024-02-20T10:00:00Z",updated_at:"2024-02-20T10:00:00Z"},{id:"3",full_name:"Алексей Козлов",email:"alexey@example.com",phone:"+7 (999) 345-67-89",status:"minister",tags:["Лидерство","Проповедь"],avatar_url:null,created_at:"2024-01-10T10:00:00Z",updated_at:"2024-01-10T10:00:00Z"}];function P(t){return t.map(r=>({id:r.id,fullName:r.full_name,email:r.email,phone:r.phone||"",status:je(r.status),tags:r.tags||[]}))}function De(){const{state:t,filteredUsers:r,addUser:e,updateUser:s,deleteUser:n,setViewMode:l,setSmartFilters:a,setIsAddModalOpen:o,setEditUser:d,resetUsers:h}=ze(D),m=f.useMemo(()=>P(r),[r]),v=f.useCallback((x,y)=>{console.debug("Smart search query:",x),a(y)},[a]),S=f.useCallback(x=>{e(x)},[e]),E=f.useCallback(x=>{window.confirm("Вы уверены, что хотите удалить этого пользователя?")&&(n(x),K.success("Пользователь удален"))},[n]),u=f.useCallback(x=>{const y=t.users.find(C=>C.id===x)||null;y&&(d(y),o(!0))},[t.users,d,o]),w=f.useCallback(x=>{s(x)},[s]),j=f.useCallback(()=>{window.confirm("Вы уверены, что хотите сбросить все данные пользователей?")&&(localStorage.removeItem("crm-users"),h(D))},[h]);return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx(Ce,{total:t.users.length}),i.jsx(Me,{viewMode:t.viewMode,onViewModeChange:l,onReset:j,onAdd:()=>{d(null),o(!0)}})]}),i.jsx(ke,{people:P(t.users),onSearch:v}),i.jsx(Ne,{people:m,viewMode:t.viewMode,onEdit:u,onDelete:E}),r.length===0&&i.jsxs("div",{className:"text-center py-12",children:[i.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100",children:"Участники не найдены"}),i.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Попробуйте изменить параметры поиска"})]}),i.jsx(Q,{isOpen:t.isAddModalOpen,onClose:()=>{o(!1),d(null)},onAddUser:S,mode:t.editUser?"edit":"add",initialUser:t.editUser,onSaveEdit:w})]})}export{De as PeopleHubPage};
